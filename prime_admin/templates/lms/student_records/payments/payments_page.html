{% extends "admin/admin_base.html" %}


{% block scripts %}
<script>
    $(document).ready(function () {
        $("#li_student_records").addClass('mm-active');
        $("#li_payments").addClass('mm-active');

        var dtPassers = $('#tbl_passers').DataTable({
            "dom": 'rtip',
            "pageLength": 20,
            "order": [[1, 'asc']],
            "processing": true,
            "serverSide": true,
            "autoWidth": false,
            "ordering": false,
            "ajax": {
                "url": "/learning-management/datatables/student-records/payments",
            }
        });

        
        $('#frm_passer').validate({
            'rules': {
                'score': {
                    'required': true,
                },
                'primary_key': {
                    'required': true
                }
            },
            'submitHandler': function(form){
                var xform = $(form);

                swal({
                    title: `Add to passers?`,
                    text: "Double check your inputted data!",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Confirm!",
                    closeOnConfirm: false,
                    showLoaderOnConfirm: true
                }, function(){
                    setTimeout(function () {
                        $.ajax({
                            type: xform.attr('method'),
                            url: xform.attr('action'),
                            data: xform.serialize(),
                            success: function (response) {
                                event.stopPropagation();
                                dtSearchStudents.ajax.reload();
                                dtPassers.ajax.reload();
                                clearForm();
                                swal("Success!", response.message, "success");
                            },
                            error: function (data) {
                                swal("Error Occured!", "Please refresh the page then try again!", "error");
                            },
                        });
                    }, 500);
                });
            }
        });
    }); // document end

    
    function clearForm(){
        $(':input','#frm_passer')
            .not(':button, :submit, :reset, :hidden')
            .val('')
            .prop('checked', false)
            .prop('selected', false);
    }
</script>
{% endblock %}


{% block content %}
<div class="app-main__inner">
    <div class="app-page-title" style="background-color: skyblue">
        <div class="page-title-wrapper">
            <div class="page-title-heading">
                <div class="page-title-icon">
                    <i class="pe-7s-users icon-gradient bg-happy-itmeo"></i>
                </div>
                <div>
                    Payments
                    <div class="page-title-subheading">
                        Enrollment > Student Records > Payments
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-card mb-3 card">
        <div class="card-body">
            <div class="form-row">
                <div class="table-responsive">
                    <table id="tbl_passers" class="align-middle mb-0 table table-bordered table-striped table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">DATE</th>
                                <th class="text-center">STUDENT NAME</th>
                                <th class="text-center">BRANCH</th>
                                <th class="text-center">AMOUNT</th>
                                <th class="text-center">PAYMENT MODE</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- load with json -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
